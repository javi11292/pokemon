{"version":3,"sources":["images/characters.png","images/world.png","images/data/world.xml","maps lazy /^/.//.*/.xml$/ groupOptions: {} namespace object","images/data/player.js","game/Player.js","game/World.js","game/index.js"],"names":["module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","t","keys","Object","meta","frames","stillDown","frame","x","SIZE","y","w","h","walkDown0","walkDown1","groupD8","MIRROR_HORIZONTAL","stillUp","walkUp0","walkUp1","stillLeft","walkLeft","stillRight","walkRight","animations","walkDown","walkUp","STATES","getTextures","spriteSheet","key","data","texture","textures","rotate","createPlayer","game","player","update","speedX","direction","CONTROLS","RIGHT","LEFT","speedY","DOWN","UP","state","speed","nextX","Math","floor","position","nextY","nextTile","world","tileAt","setNextTileData","collision","updatePosition","updateDirection","sprite","upperCase","play","setTextures","still","walk","nextDirection","setTimeout","action","face","dimension","move","SPEED","remainder","abs","offset","normalizedOffset","location","layer","split","setLocation","Loader","add","load","loader","resources","Spritesheet","characters","parse","AnimatedSprite","width","height","animationSpeed","app","screen","stage","addChild","loadTexture","worldTexture","addGraphic","tileX","tileY","object","tileSize","graphics","Graphics","name","beginTextureFill","drawRect","scale","createGame","view","utils","skipHello","settings","SCALE_MODE","SCALE_MODES","NEAREST","enableControls","Application","camera","pivot","children","length","getChildAt","getChildByName","loadMapLocation","Container","a","all","parseData","worldData","locationMap","url","default","parseMap","layers","columns","value","objects","forEach","row","i","j","parseInt","removeChildren","addChildAt","createWorld","window","addEventListener","detail","ticker"],"mappings":"qFAAAA,EAAOC,QAAU,IAA0B,wC,oBCA3CD,EAAOC,QAAU,IAA0B,mC,oBCA3CD,EAAOC,QAAU,IAA0B,mC,oBCA3C,IAAIC,EAAM,CACT,mBAAoB,CACnB,IACA,GAED,wBAAyB,CACxB,IACA,IAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBP,EAAM,KAEjD,MADAM,EAAEE,KAAO,mBACHF,KAIR,IAAIG,EAAMX,EAAIE,GAAMU,EAAKD,EAAI,GAC7B,OAAOR,EAAoBK,EAAEG,EAAI,IAAIJ,MAAK,WACzC,OAAOJ,EAAoBU,EAAED,EAAI,MAGnCX,EAAoBa,KAAO,WAC1B,OAAOC,OAAOD,KAAKd,IAEpBC,EAAoBW,GAAK,IACzBd,EAAOC,QAAUE,G,wHCvBF,GACbe,KAAM,GACNC,OAAQ,CACNC,UAAW,CACTC,MAAO,CACLC,EAAGC,GACHC,EAAGD,IACHE,EAVK,GAWLC,EAXK,KAcTC,UAAW,CACTN,MAAO,CACLC,EAAGC,GACHC,EAAGD,IACHE,EAlBK,GAmBLC,EAnBK,KAsBTE,UAAU,aACRP,MAAO,CACLC,EAAGC,GACHC,EAAGD,IACHE,EA1BK,GA2BLC,EA3BK,KACE,SA4BCG,IAAQC,mBAGpBC,QAAS,CACPV,MAAO,CACLC,EAAGC,IACHC,EAAGD,IACHE,EApCK,GAqCLC,EArCK,KAwCTM,QAAS,CACPX,MAAO,CACLC,EAAGC,GACHC,EAAGD,IACHE,EA5CK,GA6CLC,EA7CK,KAgDTO,QAAQ,aACNZ,MAAO,CACLC,EAAGC,GACHC,EAAGD,IACHE,EApDK,GAqDLC,EArDK,KACE,SAsDCG,IAAQC,mBAIpBI,UAAW,CACTb,MAAO,CACLC,EAAGC,EACHC,EAAGD,IACHE,EA/DK,GAgELC,EAhEK,KAmETS,SAAU,CACRd,MAAO,CACLC,EAAGC,GACHC,EAAGD,IACHE,EAvEK,GAwELC,EAxEK,KA4ETU,WAAW,aACTf,MAAO,CACLC,EAAGC,EACHC,EAAGD,IACHE,EAhFK,GAiFLC,EAjFK,KACE,SAkFCG,IAAQC,mBAEpBO,UAAU,aACRhB,MAAO,CACLC,EAAGC,GACHC,EAAGD,IACHE,EAzFK,GA0FLC,EA1FK,KACE,SA2FCG,IAAQC,oBAGtBQ,WAAY,CACVC,SAAU,CAAC,YAAa,YAAa,YAAa,aAClDC,OAAQ,CAAC,UAAW,UAAW,UAAW,WAC1CL,SAAU,CAAC,WAAY,aACvBE,UAAW,CAAC,YAAa,gB,0BC/FvBI,EACG,QADHA,EAEE,OAGR,SAASC,EAAYC,EAAaC,GAChC,OAAOD,EAAYE,KAAKP,WAAWM,GAAK1C,KAAI,SAAAY,GAAO,IAAD,EAC1CgC,EAAUH,EAAYI,SAASjC,GAErC,OADAgC,EAAQE,OAAR,UAAiBL,EAAYE,KAAK1B,OAAOL,GAAIkC,cAA7C,QAAuDF,EAAQE,OACxDF,KAIJ,SAASG,EAAaC,GAC3B,IAAMC,EAAS,CACbD,OACAE,OAgGF,WACE,IAAMC,EAASF,EAAOG,YAAcC,IAASC,MAAQ,EAAIL,EAAOG,YAAcC,IAASE,MAAQ,EAAI,EAC7FC,EAASP,EAAOG,YAAcC,IAASI,KAAO,EAAIR,EAAOG,YAAcC,IAASK,IAAM,EAAI,EAE5FT,EAAOU,QAAUpB,GAAgBU,EAAOW,MAAMxC,GAAM6B,EAAOW,MAAMtC,GAjBvE,SAAyB6B,EAAQK,GAC/B,IAAMK,EAAQC,KAAKC,MAAMd,EAAOe,SAAS5C,EAAIC,IAAO8B,GAC9Cc,EAAQH,KAAKC,MAAMd,EAAOe,SAAS1C,EAAID,IAAOmC,GAEpD,GAAIP,EAAOiB,SAAS9C,IAAMyC,GAASZ,EAAOiB,SAAS5C,IAAM2C,EAAO,OAEhEhB,EAAOiB,SAAW,CAChB9C,EAAGyC,EACHvC,EAAG2C,EACHtB,KAAMM,EAAOD,KAAKmB,MAAMC,OAAOP,EAAOI,IAQgCI,CAAgBlB,EAAQK,GAE5FP,EAAOU,QAAUpB,GAAgBU,EAAOW,MAAMxC,GAAM6B,EAAOW,MAAMtC,GAAwC,UAAnC2B,EAAOiB,SAASvB,KAAK2B,UAIpFrB,EAAOW,MAAMxC,GAAK6B,EAAOW,MAAMtC,EACxCiD,EAAetB,EAAOW,MAAMxC,EAAI,IAAM,KAEtCoD,KANAvB,EAAOW,MAAMxC,EAAI+B,EACjBF,EAAOW,MAAMtC,EAAIkC,EACjBe,EAAetB,EAAOW,MAAMxC,EAAI,IAAM,KAAK,KA7D/C,WACE,IAAK6B,EAAOwB,OAAQ,OACpB,IAAM5B,EAAWI,EAAOJ,SAASI,EAAOU,MAAQe,YAAUzB,EAAOG,YACjE,IAAKP,GAAYI,EAAOwB,OAAO5B,WAAaA,EAAU,OACtDI,EAAOwB,OAAO5B,SAAWA,EACzBI,EAAOwB,OAAOE,OA+DdC,IA/GAC,QACAC,OACAL,OAAQ,KACRd,MAAO,KACPP,UAAWC,IAASI,KACpBsB,cAAe,KACff,SAAU,CAAE5C,EAAU,EAAPC,IAAUC,EAAU,EAAPD,KAC5BuC,MAAO,CAAExC,EAAG,EAAGE,EAAG,GAClB4C,SAAU,CAAEvB,KAAM,IAClBE,SAAU,CACR3B,UAAW,GACXW,QAAS,GACTG,UAAW,GACXE,WAAY,GACZG,SAAU,GACVC,OAAQ,GACRL,SAAU,GACVE,UAAW,KAIf,SAAS0C,IACP5B,EAAOU,MAAQpB,EAWjB,SAASuC,EAAK1B,GACRH,EAAOG,YAAcA,GAAaH,EAAOU,QAAUpB,GAKvDU,EAAO8B,cAAgB3B,EACvBH,EAAOU,MAAQpB,GAfjB,SAAca,GACZ4B,YAAW,WACT/B,EAAOG,UAAYA,EACfA,IAAcH,EAAOD,KAAKiC,OAAQH,EAAK1B,GACtCyB,MACJ,KAKDK,CAAK9B,GAgBT,SAASoB,IACHvB,EAAO8B,gBACT9B,EAAOG,UAAYH,EAAO8B,cAC1B9B,EAAO8B,cAAgB,MAI3B,SAASR,EAAeY,EAAWC,GACjC,GAAKnC,EAAOW,MAAMuB,GAAlB,CAEA,IAAMvB,EAAQX,EAAOW,MAAMuB,GAAaE,IAClCC,EAAYxB,KAAKyB,IAAItC,EAAOe,SAASmB,GAAa9D,KAElDmE,EAASF,IAA0C,IAA5BrC,EAAOW,MAAMuB,GAAmBG,EAAYjE,IAAOiE,GAEhF,GAAIA,EAAW,CACb,IAAMG,EAAmBxC,EAAOe,SAASmB,IAAc,EAAIK,EAASnE,IAAOmE,EAC3EvC,EAAOe,SAASmB,IAAcM,GAAoBJ,IAAQzB,EAAQ6B,EAAmBxC,EAAOW,MAAMuB,QAC7F,GAAIC,EACTnC,EAAOe,SAASmB,IAAcvB,MACzB,CACLX,EAAOW,MAAMuB,GAAa,EAC1BX,IAFK,IAGG7B,EAASM,EAAOiB,SAAhBvB,KACR,GAAIA,EAAK+C,UAAY/C,EAAKgD,MAAO,CAAC,IAAD,EAChBhD,EAAKqB,SAAS4B,MAAM,KADJ,mBACxBxE,EADwB,KACrBE,EADqB,KAE/B2B,EAAOD,KAAKmB,MAAM0B,YAAYlD,EAAK+C,SAAU/C,EAAKgD,MAAO,CAAEvE,EAAGA,EAAIC,IAAMC,EAAGA,EAAID,IAAOA,SAoE5F,OA9BE,IAAIyE,KAASC,IAAI,aAAcnD,KAASoD,MAAK,SAACC,EAAQC,GACpD,IAAMzD,EAAc,IAAI0D,IAAYD,EAAUE,WAAWxD,QAASD,GAElEF,EAAY4D,OAAM,WAChBpD,EAAOJ,SAAS3B,UAAY,CAACuB,EAAYI,SAAS3B,WAClD+B,EAAOJ,SAAShB,QAAU,CAACY,EAAYI,SAAShB,SAChDoB,EAAOJ,SAASb,UAAY,CAACS,EAAYI,SAASb,WAClDiB,EAAOJ,SAASX,WAAa,CAACO,EAAYI,SAASX,YAEnDe,EAAOJ,SAASR,SAAWG,EAAYC,EAAa,YACpDQ,EAAOJ,SAASP,OAASE,EAAYC,EAAa,UAClDQ,EAAOJ,SAASZ,SAAWO,EAAYC,EAAa,YACpDQ,EAAOJ,SAASV,UAAYK,EAAYC,EAAa,aAErD,IAAMgC,EAAS,IAAI6B,IAAerD,EAAOJ,SAAP,eAAwB6B,YAAUzB,EAAOG,cAE3EqB,EAAO8B,MAAQlF,IACfoD,EAAO+B,OAASnF,IAChBoD,EAAOgC,eAAiB,GACxBhC,EAAOrD,EAAI6B,EAAOD,KAAK0D,IAAIC,OAAOJ,MAAQ,EAAI9B,EAAO8B,MAAQ,EAC7D9B,EAAOnD,EAAI2B,EAAOD,KAAK0D,IAAIC,OAAOH,OAAS,EAAI/B,EAAO+B,OAAS,EAC/DvD,EAAOwB,OAASA,EAEhBxB,EAAOD,KAAK0D,IAAIE,MAAMC,SAASpC,SAO9BxB,E,yEClKT,SAAS6D,IACP,OAAO,IAAIzG,SAAQ,SAAAC,IACjB,IAAIwF,KAASC,IAAI,QAASgB,KAAcf,MAAK,SAACC,EAAQC,GACpD5F,EAAQ4F,EAAU/B,MAAMvB,eAK9B,SAASoE,EAAT,GAA6E,IAAvDpE,EAAsD,EAAtDA,QAAS5C,EAA6C,EAA7CA,IAAKiH,EAAwC,EAAxCA,MAAOC,EAAiC,EAAjCA,MAAO9F,EAA0B,EAA1BA,EAAGE,EAAuB,EAAvBA,EAAG6F,EAAoB,EAApBA,OAAQC,EAAY,EAAZA,SACxDC,EAAW,IAAIC,IACrBD,EAASE,KAAT,UAAmBnG,EAAnB,YAAwBE,GACxB+F,EAAS1E,KAAOwE,EAEhBE,EAASG,iBAAiB,CAAE5E,YAC5ByE,EAASI,SAASR,EAAOC,EAAOE,EAAUA,GAE1CC,EAASd,MAAQlF,IACjBgG,EAASb,OAASnF,IAElBgG,EAASjG,GAAK6F,EAAQI,EAASK,MAAMtG,EAAIA,EAAIC,IAC7CgG,EAAS/F,GAAK4F,EAAQG,EAASK,MAAMpG,EAAIA,EAAID,IAE7CrB,EAAI6G,SAASQ,GCvBR,SAASM,EAAWC,GACzBC,IAAMC,YACNC,IAASC,WAAaC,IAAYC,QAElC,IAAMlF,EAAO,CACX0D,IAAK,KACLzB,OAAQ,KACRhC,OAAQ,KACRkB,MAAO,KACPgE,gBAAgB,GAGlBnF,EAAK0D,IAAM,IAAI0B,IAAY,CACzBR,OACArB,MAAO,KACPC,OAAQ,OAGVxD,EAAKC,OAASF,EAAaC,GAC3BA,EAAKmB,MDOA,SAAqBnB,GAC1B,IAAMmB,EAAQ,CACZnB,OACAE,OAiBF,WAAmB,IAAD,IACVc,EAAWG,EAAMnB,KAAKC,OAAOe,SACnCG,EAAMkE,OAAOC,MAAMlH,IAAI,UAAC+C,EAAMnB,KAAKC,OAAOwB,cAAnB,aAAC,EAA0BrD,GAClD+C,EAAMkE,OAAOC,MAAMhH,IAAI,UAAC6C,EAAMnB,KAAKC,OAAOwB,cAAnB,aAAC,EAA0BnD,GAClD6C,EAAMkE,OAAOrE,SAAS5C,GAAK4C,EAAS5C,EACpC+C,EAAMkE,OAAOrE,SAAS1C,GAAK0C,EAAS1C,GArBpC8C,OAwFF,SAAgBhD,EAAGE,GAAI,IAAD,EACpB,OAAK6C,EAAMkE,OAAOE,SAASC,SACpB,UAAArE,EAAMkE,OAAOI,WAAW,GAAGC,eAA3B,UAA6CtH,EAA7C,YAAkDE,WAAlD,eAAwDqB,OADrB,IAxF1CkD,YASF,SAAqBH,EAAUC,EAAO3B,GACpCG,EAAMuB,SAAWA,GAAYvB,EAAMuB,SACnCvB,EAAMwB,MAAQA,EACdgD,EAAgB3E,IAXhB0B,SAAU,kBACVC,MAAO,YACP/C,QAAS,KACTD,KAAM,KACN3C,IAAK,GACLqI,OAAQ,IAAIO,KAXkB,4CA4BhC,kCAAAC,EAAA,sEACgCxI,QAAQyI,IAAI,CAAChC,IAAeiC,YAAUC,OADtE,0CACSpG,EADT,KACkBD,EADlB,KAEEwB,EAAMvB,QAAUA,EAChBuB,EAAMxB,KAAOA,EAHf,UAIQgG,IAJR,QAKExE,EAAMnB,KAAKmF,gBAAiB,EAL9B,6CA5BgC,+BAoCjBQ,EApCiB,8EAoChC,WAA+B3E,GAA/B,qCAAA6E,EAAA,yDACUnD,EAAavB,EAAbuB,SACFC,EAAQxB,EAAMwB,OAAS,QACzBsD,EAAc9E,EAAMnE,IAAI0F,EAAWC,GAHzC,wBAMIsD,EAAc,IAAIL,IANtB,SAOmC,OAAO,YAAQlD,EAAf,SAPnC,uBAOqBwD,EAPrB,EAOYC,QAPZ,UAQyBC,YAASF,GARlC,QAQUG,EARV,SASkClF,EAAMxB,KAA5ByE,EATZ,EASYA,SAAUkC,EATtB,EASsBA,QATtB,EAUoCD,EAAO1D,GAAxB3F,EAVnB,EAUYuJ,MAAYC,EAVxB,EAUwBA,QAEpBxJ,EAAI4F,MAAM,MAAM6D,SAAQ,SAACC,EAAKC,GAAN,OAAYD,EAAI9D,MAAM,KAAK6D,SAAQ,SAACF,EAAOK,GACjE,GAAKL,GAAmB,MAAVA,EAAd,CACA,IAAM3I,EAAKiJ,SAASN,EAAO,IAAM,EAC3BpC,EAAShD,EAAMxB,KAAK/B,IAAO,GAC3BqG,EAASrG,EAAK0I,EAAWlC,EACzBF,EAAQpD,KAAKC,MAAMnD,EAAK0I,GAAWlC,EAEzCJ,EAAW,CACTpE,QAASuB,EAAMvB,QACf5C,IAAKiJ,EACLhC,QACAC,QACA9F,EAAGwI,EACHtI,EAAGqI,EACHvC,WACAD,kBAIJqC,EAAQC,SAAQ,SAAAtC,GACd,IAAMvG,EAAKiJ,SAAS1C,EAAOvG,GAAI,IAAM,EAC/BqG,EAASrG,EAAK0I,EAAWlC,EACzBF,EAAQpD,KAAKC,MAAMnD,EAAK0I,GAAWlC,EAEzCJ,EAAW,CACTpE,QAASuB,EAAMvB,QACf5C,IAAKiJ,EACLhC,QACAC,QACA9F,EAAG+F,EAAO/F,EAAIgG,EACd9F,EAAG6F,EAAO7F,EAAI8F,EACdA,WACAD,OAAO,eAAOhD,EAAMxB,KAAK/B,IAAO,GAA1B,GAAkCuG,QAI5ChD,EAAMnE,IAAI0F,EAAWC,GAASsD,EAhDlC,QAmDE9E,EAAMkE,OAAOyB,iBACb3F,EAAMkE,OAAOxB,SAASoC,GAClBjF,IAAUG,EAAMnB,KAAKC,OAAOe,SAAWA,GArD7C,6CApCgC,sBAoGhC,OApGgC,mCAiGhCgC,GACAhD,EAAK0D,IAAIE,MAAMmD,WAAW5F,EAAMkE,OAAQ,GAEjClE,EC3GM6F,CAAYhH,GAqBzBiH,OAAOC,iBAAiB,UAnBxB,YAAmC,IAAXC,EAAU,EAAVA,OACtB,GAAKnH,EAAKmF,eAGV,OAFAnF,EAAKiC,OAASkF,EAENnH,EAAKiC,QACX,KAAK5B,IAASK,GACd,KAAKL,IAASE,KACd,KAAKF,IAASC,MACd,KAAKD,IAASI,KACZT,EAAKC,OAAO6B,KAAK9B,EAAKiC,QACtB,MAGF,QACEjC,EAAKC,OAAO4B,YAOlB7B,EAAK0D,IAAI0D,OAAOrE,KAAI,WAClB/C,EAAKC,OAAOC,SACZF,EAAKmB,MAAMjB","file":"static/js/4.6dbc6953.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/characters.111f6faf.png\";","module.exports = __webpack_public_path__ + \"static/media/world.74af39e9.png\";","module.exports = __webpack_public_path__ + \"static/media/world.602efee1.xml\";","var map = {\n\t\"./PalletTown.xml\": [\n\t\t136,\n\t\t5\n\t],\n\t\"./PalletTownRooms.xml\": [\n\t\t137,\n\t\t6\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__.t(id, 7);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 135;\nmodule.exports = webpackAsyncContext;","import { groupD8 } from \"pixi.js\"\n\nconst SIZE = 16\nconst ROTATE = \"rotate\"\n\nexport default {\n  meta: {},\n  frames: {\n    stillDown: {\n      frame: {\n        x: SIZE * 6,\n        y: SIZE * 14,\n        w: SIZE,\n        h: SIZE,\n      },\n    },\n    walkDown0: {\n      frame: {\n        x: SIZE * 1,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n    },\n    walkDown1: {\n      frame: {\n        x: SIZE * 1,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n      [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n    },\n\n    stillUp: {\n      frame: {\n        x: SIZE * 7,\n        y: SIZE * 14,\n        w: SIZE,\n        h: SIZE,\n      },\n    },\n    walkUp0: {\n      frame: {\n        x: SIZE * 2,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n    },\n    walkUp1: {\n      frame: {\n        x: SIZE * 2,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n      [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n    },\n\n\n    stillLeft: {\n      frame: {\n        x: SIZE * 0,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n    },\n    walkLeft: {\n      frame: {\n        x: SIZE * 3,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n    },\n\n    stillRight: {\n      frame: {\n        x: SIZE * 0,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n      [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n    },\n    walkRight: {\n      frame: {\n        x: SIZE * 3,\n        y: SIZE * 15,\n        w: SIZE,\n        h: SIZE,\n      },\n      [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n    },\n  },\n  animations: {\n    walkDown: [\"walkDown0\", \"stillDown\", \"walkDown1\", \"stillDown\"],\n    walkUp: [\"walkUp0\", \"stillUp\", \"walkUp1\", \"stillUp\"],\n    walkLeft: [\"walkLeft\", \"stillLeft\"],\n    walkRight: [\"walkRight\", \"stillRight\"],\n  },\n}","import { Spritesheet, AnimatedSprite, Loader } from \"pixi.js\"\nimport data from \"images/data/player\"\nimport texture from \"images/characters.png\"\nimport { upperCase } from \"libraries/util\"\nimport { CONTROLS, SIZE, SPEED } from \"libraries/constants\"\n\nconst STATES = {\n  STILL: \"still\",\n  WALK: \"walk\",\n}\n\nfunction getTextures(spriteSheet, key) {\n  return spriteSheet.data.animations[key].map(id => {\n    const texture = spriteSheet.textures[id]\n    texture.rotate = spriteSheet.data.frames[id].rotate ?? texture.rotate\n    return texture\n  })\n}\n\nexport function createPlayer(game) {\n  const player = {\n    game,\n    update,\n    still,\n    walk,\n    sprite: null,\n    state: null,\n    direction: CONTROLS.DOWN,\n    nextDirection: null,\n    position: { x: SIZE * 3, y: SIZE * 7 },\n    speed: { x: 0, y: 0 },\n    nextTile: { data: {} },\n    textures: {\n      stillDown: [],\n      stillUp: [],\n      stillLeft: [],\n      stillRight: [],\n      walkDown: [],\n      walkUp: [],\n      walkLeft: [],\n      walkRight: [],\n    },\n  }\n\n  function still() {\n    player.state = STATES.STILL\n  }\n\n  function face(direction) {\n    setTimeout(() => {\n      player.direction = direction\n      if (direction === player.game.action) walk(direction)\n      else still()\n    }, 100)\n  }\n\n  function walk(direction) {\n    if (player.direction !== direction && player.state !== STATES.WALK) {\n      face(direction)\n      return\n    }\n\n    player.nextDirection = direction\n    player.state = STATES.WALK\n  }\n\n  function setTextures() {\n    if (!player.sprite) return\n    const textures = player.textures[player.state + upperCase(player.direction)]\n    if (!textures || player.sprite.textures === textures) return\n    player.sprite.textures = textures\n    player.sprite.play()\n  }\n\n  function updateDirection() {\n    if (player.nextDirection) {\n      player.direction = player.nextDirection\n      player.nextDirection = null\n    }\n  }\n\n  function updatePosition(dimension, move) {\n    if (!player.speed[dimension]) return\n\n    const speed = player.speed[dimension] * SPEED\n    const remainder = Math.abs(player.position[dimension] % SIZE)\n\n    const offset = remainder && (player.speed[dimension] === 1 ? remainder : SIZE - remainder)\n\n    if (remainder) {\n      const normalizedOffset = player.position[dimension] <= 0 ? offset : SIZE - offset\n      player.position[dimension] += normalizedOffset >= SPEED ? speed : normalizedOffset * player.speed[dimension]\n    } else if (move) {\n      player.position[dimension] += speed\n    } else {\n      player.speed[dimension] = 0\n      updateDirection()\n      const { data } = player.nextTile\n      if (data.location || data.layer) {\n        const [x, y] = data.position.split(\",\")\n        player.game.world.setLocation(data.location, data.layer, { x: x * SIZE, y: y * SIZE + SIZE })\n      }\n    }\n  }\n\n  function setNextTileData(speedX, speedY) {\n    const nextX = Math.floor(player.position.x / SIZE + speedX)\n    const nextY = Math.floor(player.position.y / SIZE + speedY)\n\n    if (player.nextTile.x === nextX && player.nextTile.y === nextY) return\n\n    player.nextTile = {\n      x: nextX,\n      y: nextY,\n      data: player.game.world.tileAt(nextX, nextY),\n    }\n  }\n\n  function update() {\n    const speedX = player.direction === CONTROLS.RIGHT ? 1 : player.direction === CONTROLS.LEFT ? -1 : 0\n    const speedY = player.direction === CONTROLS.DOWN ? 1 : player.direction === CONTROLS.UP ? -1 : 0\n\n    if (player.state === STATES.WALK && !player.speed.x && !player.speed.y) setNextTileData(speedX, speedY)\n\n    if (player.state === STATES.WALK && !player.speed.x && !player.speed.y && player.nextTile.data.collision === \"false\") {\n      player.speed.x = speedX\n      player.speed.y = speedY\n      updatePosition(player.speed.x ? \"x\" : \"y\", true)\n    } else if (player.speed.x || player.speed.y) {\n      updatePosition(player.speed.x ? \"x\" : \"y\")\n    } else {\n      updateDirection()\n    }\n\n    setTextures()\n  }\n\n  function addSpriteSheet() {\n    new Loader().add(\"characters\", texture).load((loader, resources) => {\n      const spriteSheet = new Spritesheet(resources.characters.texture, data)\n\n      spriteSheet.parse(() => {\n        player.textures.stillDown = [spriteSheet.textures.stillDown]\n        player.textures.stillUp = [spriteSheet.textures.stillUp]\n        player.textures.stillLeft = [spriteSheet.textures.stillLeft]\n        player.textures.stillRight = [spriteSheet.textures.stillRight]\n\n        player.textures.walkDown = getTextures(spriteSheet, \"walkDown\")\n        player.textures.walkUp = getTextures(spriteSheet, \"walkUp\")\n        player.textures.walkLeft = getTextures(spriteSheet, \"walkLeft\")\n        player.textures.walkRight = getTextures(spriteSheet, \"walkRight\")\n\n        const sprite = new AnimatedSprite(player.textures[`still${upperCase(player.direction)}`])\n\n        sprite.width = SIZE\n        sprite.height = SIZE\n        sprite.animationSpeed = 0.1\n        sprite.x = player.game.app.screen.width / 2 - sprite.width / 2\n        sprite.y = player.game.app.screen.height / 2 - sprite.height / 2\n        player.sprite = sprite\n\n        player.game.app.stage.addChild(sprite)\n      })\n    })\n  }\n\n  addSpriteSheet()\n\n  return player\n}","import { Graphics, Loader, Container } from \"pixi.js\"\nimport worldTexture from \"images/world.png\"\nimport worldData from \"images/data/world.xml\"\nimport { SIZE } from \"libraries/constants\"\nimport { parseData, parseMap } from \"libraries/util\"\n\nfunction loadTexture() {\n  return new Promise(resolve => {\n    new Loader().add(\"world\", worldTexture).load((loader, resources) => {\n      resolve(resources.world.texture)\n    })\n  })\n}\n\nfunction addGraphic({ texture, map, tileX, tileY, x, y, object, tileSize }) {\n  const graphics = new Graphics()\n  graphics.name = `${x}-${y}`\n  graphics.data = object\n\n  graphics.beginTextureFill({ texture })\n  graphics.drawRect(tileX, tileY, tileSize, tileSize)\n\n  graphics.width = SIZE\n  graphics.height = SIZE\n\n  graphics.x = -tileX * graphics.scale.x + x * SIZE\n  graphics.y = -tileY * graphics.scale.y + y * SIZE\n\n  map.addChild(graphics)\n}\n\nexport function createWorld(game) {\n  const world = {\n    game,\n    update,\n    tileAt,\n    setLocation,\n    location: \"PalletTownRooms\",\n    layer: \"house1 f2\",\n    texture: null,\n    data: null,\n    map: {},\n    camera: new Container(),\n  }\n\n  function setLocation(location, layer, position) {\n    world.location = location || world.location\n    world.layer = layer\n    loadMapLocation(position)\n  }\n\n  function update() {\n    const position = world.game.player.position\n    world.camera.pivot.x = -world.game.player.sprite?.x\n    world.camera.pivot.y = -world.game.player.sprite?.y\n    world.camera.position.x = -position.x\n    world.camera.position.y = -position.y\n  }\n\n  async function load() {\n    const [texture, data] = await Promise.all([loadTexture(), parseData(worldData)])\n    world.texture = texture\n    world.data = data\n    await loadMapLocation()\n    world.game.enableControls = true\n  }\n\n  async function loadMapLocation(position) {\n    const { location } = world\n    const layer = world.layer || \"index\"\n    let locationMap = world.map[location + layer]\n\n    if (!locationMap) {\n      locationMap = new Container()\n      const { default: url } = await import(`maps/${location}.xml`)\n      const layers = await parseMap(url)\n      const { tileSize, columns } = world.data\n      const { value: map, objects } = layers[layer]\n\n      map.split(\"\\n\").forEach((row, i) => row.split(\",\").forEach((value, j) => {\n        if (!value || value === \"0\") return\n        const id = parseInt(value, 10) - 1\n        const object = world.data[id] || {}\n        const tileX = (id % columns) * tileSize\n        const tileY = Math.floor(id / columns) * tileSize\n\n        addGraphic({\n          texture: world.texture,\n          map: locationMap,\n          tileX,\n          tileY,\n          x: j,\n          y: i,\n          tileSize,\n          object,\n        })\n      }))\n\n      objects.forEach(object => {\n        const id = parseInt(object.id, 10) - 1\n        const tileX = (id % columns) * tileSize\n        const tileY = Math.floor(id / columns) * tileSize\n\n        addGraphic({\n          texture: world.texture,\n          map: locationMap,\n          tileX,\n          tileY,\n          x: object.x / tileSize,\n          y: object.y / tileSize,\n          tileSize,\n          object: { ...(world.data[id] || {}), ...object },\n        })\n      })\n\n      world.map[location + layer] = locationMap\n    }\n\n    world.camera.removeChildren()\n    world.camera.addChild(locationMap)\n    if (position) world.game.player.position = position\n  }\n\n  function tileAt(x, y) {\n    if (!world.camera.children.length) return {}\n    return world.camera.getChildAt(0).getChildByName(`${x}-${y}`)?.data || {}\n  }\n\n  load()\n  game.app.stage.addChildAt(world.camera, 0)\n\n  return world\n}","import { Application, utils, settings, SCALE_MODES } from \"pixi.js\"\nimport { CONTROLS } from \"libraries/constants\"\nimport { createPlayer } from \"./Player\"\nimport { createWorld } from \"./World\"\n\nexport function createGame(view) {\n  utils.skipHello()\n  settings.SCALE_MODE = SCALE_MODES.NEAREST\n\n  const game = {\n    app: null,\n    action: null,\n    player: null,\n    world: null,\n    enableControls: false,\n  }\n\n  game.app = new Application({\n    view,\n    width: 1920,\n    height: 1080,\n  })\n\n  game.player = createPlayer(game)\n  game.world = createWorld(game)\n\n  function handleAction({ detail }) {\n    if (!game.enableControls) return\n    game.action = detail\n\n    switch (game.action) {\n      case CONTROLS.UP:\n      case CONTROLS.LEFT:\n      case CONTROLS.RIGHT:\n      case CONTROLS.DOWN: {\n        game.player.walk(game.action)\n        break\n      }\n\n      default: {\n        game.player.still()\n      }\n    }\n  }\n\n  window.addEventListener(\"action\", handleAction)\n\n  game.app.ticker.add(() => {\n    game.player.update()\n    game.world.update()\n  })\n}"],"sourceRoot":""}