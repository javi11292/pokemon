{"version":3,"sources":["libraries/database.js","images/characters.png","images/world.png","scripts lazy /^/.//.*$/ groupOptions: {} namespace object","maps lazy /^/.//.*/.json$/ groupOptions: {} namespace object","game/Character.js","game/Player.js","game/World.js","game/index.js"],"names":["playerDB","localForage","createInstance","name","CHARACTERS","PLAYER","storeName","getEventsDB","module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","t","keys","Object","STATES","createCharacter","game","container","x","y","still","face","walk","update","postUpdate","updateNextTile","updatePosition","updateState","updateTextures","addSpritesheet","loadSprite","a","character","textures","stillDown","spritesheet","stillUp","stillLeft","stillRight","walkDown","getTextures","walkUp","walkLeft","walkRight","sprite","AnimatedSprite","state","upperCase","direction","width","SIZE","height","animationSpeed","addChild","Spritesheet","resources","characters","texture","getData","parse","play","nextDirection","nextState","world","tileAt","position","dimension","move","speed","SPEED","speedX","speedY","nextX","Math","floor","nextY","nextTile","data","CONTROLS","RIGHT","LEFT","DOWN","UP","event","check","collision","properties","visible","loadingResources","loadResources","database","location","layer","value","assign","setItem","onNextTileUpdate","promise","newEvent","createEvent","newValue","newPosition","getItem","createPosition","app","ticker","add","Loader","load","loader","loadedResources","startX","startY","removeCharacter","positionDB","newX","newY","spriteSheet","key","animations","rotate","frames","meta","frame","getFrame","groupD8","MIRROR_HORIZONTAL","w","h","callback","createPlayer","loadEvent","events","prevTile","characterUpdateState","player","split","setLocation","characterWalk","characterFace","faceTimeout","setTimeout","characterStill","clearTimeout","stage","screen","createWorld","loadMapLocation","loadTile","loadObject","item","tilesets","locationTiles","locationCharacters","locationMap","promises","tileSize","columns","objects","forEach","object","gid","firstgid","tileX","tileY","tiles","reduce","addProperties","addGraphic","push","index","parseInt","eventsImport","catch","Container","layers","type","all","getEvents","camera","removeChildren","loadTexture","worldData","tilewidth","acc","tile","enableControls","pivot","newLocation","newLayer","addChildAt","UPDATE_PRIORITY","INTERACTION","worldTexture","graphics","Graphics","beginTextureFill","drawRect","scale","property","createGame","handleAction","detail","action","view","setMessage","save","prepareGame","loadText","window","addEventListener","utils","skipHello","settings","SCALE_MODE","SCALE_MODES","NEAREST","Application","renderer","plugins","accessibility","destroy","accesibility"],"mappings":"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","file":"static/js/6.37e5751e.chunk.js","sourcesContent":["import localForage from \"localforage\"\nimport { CHARACTERS } from \"./constants\"\n\nexport const playerDB = localForage.createInstance({ name: CHARACTERS.PLAYER, storeName: \"index\" })\n\nexport function getEventsDB(storeName) {\n  return localForage.createInstance({ name: \"events\", storeName })\n}","module.exports = __webpack_public_path__ + \"static/media/characters.111f6faf.png\";","module.exports = __webpack_public_path__ + \"static/media/world.74af39e9.png\";","var map = {\n\t\"./PalletTown\": [\n\t\t107,\n\t\t9,\n\t\t0\n\t],\n\t\"./PalletTown/\": [\n\t\t107,\n\t\t9,\n\t\t0\n\t],\n\t\"./PalletTown/index\": [\n\t\t107,\n\t\t9,\n\t\t0\n\t],\n\t\"./PalletTown/index.js\": [\n\t\t107,\n\t\t9,\n\t\t0\n\t],\n\t\"./welcome.txt\": [\n\t\t77,\n\t\t7,\n\t\t1\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[2]).then(function() {\n\t\treturn __webpack_require__.t(id, ids[1])\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 132;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./PalletTown.json\": [\n\t\t134,\n\t\t7\n\t],\n\t\"./PalletTownRooms.json\": [\n\t\t135,\n\t\t8\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__.t(id, 3);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 133;\nmodule.exports = webpackAsyncContext;","import { Spritesheet, AnimatedSprite, Loader, groupD8 } from \"pixi.js\"\nimport localForage from \"localforage\"\nimport texture from \"images/characters.png\"\nimport { upperCase } from \"libraries/util\"\nimport { CONTROLS, SIZE, SPEED, CHARACTERS } from \"libraries/constants\"\n\nconst TILE_SIZE = 16\nconst COLUMNS = 8\nconst ROTATE = \"rotate\"\n\nexport const STATES = {\n  STILL: \"still\",\n  WALK: \"walk\",\n}\n\nexport async function createCharacter(game, id, container, x, y) {\n  if (!resources && !loadingResources) {\n    loadingResources = await loadResources()\n  }\n\n  const database = localForage.createInstance({ name: id, storeName: id !== CHARACTERS.PLAYER ? game.world.location + game.world.layer : \"index\" })\n\n  const character = {\n    database,\n    game,\n    collision: true,\n    still,\n    face,\n    walk,\n    updateState,\n    get properties() {\n      return properties\n    },\n    set properties(value) {\n      Object.assign(properties, value)\n      database.setItem(\"properties\", properties)\n\n      character.sprite.visible = properties.visible !== false\n    },\n    postUpdate,\n    onNextTileUpdate: () => { },\n    get event() {\n      return event.promise\n    },\n    set event(newEvent) {\n      event = createEvent(newEvent)\n    },\n    sprite: null,\n    state: STATES.STILL,\n    direction: CONTROLS.DOWN,\n    speed: { x: 0, y: 0 },\n    nextDirection: null,\n    nextState: null,\n    get nextTile() {\n      return nextTile\n    },\n    set nextTile(newValue) {\n      nextTile = newValue\n      character.onNextTileUpdate(newValue)\n    },\n    get position() {\n      return position\n    },\n    set position(newPosition) {\n      if (position.x % SIZE === 0 && position.y % SIZE === 0) {\n        game.world.tileAt(position.x / SIZE, position.y, { character: null })\n      }\n\n      position.x = newPosition.x\n      position.y = newPosition.y\n    },\n    // common fields\n    spritesheet: characters[id]?.spritesheet,\n    textures: characters[id]?.textures || {\n      stillDown: [],\n      stillUp: [],\n      stillLeft: [],\n      stillRight: [],\n      walkDown: [],\n      walkUp: [],\n      walkLeft: [],\n      walkRight: [],\n    },\n  }\n\n  function still(direction) {\n    character.nextState = STATES.STILL\n    if (direction) character.nextDirection = direction\n  }\n\n  function face(direction) {\n    character.nextDirection = direction\n  }\n\n  function walk(direction) {\n    face(direction)\n    character.nextState = STATES.WALK\n  }\n\n  function update() {\n    const speedX = character.direction === CONTROLS.RIGHT ? 1 : character.direction === CONTROLS.LEFT ? -1 : 0\n    const speedY = character.direction === CONTROLS.DOWN ? 1 : character.direction === CONTROLS.UP ? -1 : 0\n\n    if (character.state === STATES.WALK && !character.speed.x && !character.speed.y) updateNextTile(speedX, speedY)\n\n    if (event && event.check()) {\n      event = null\n    }\n\n    if (\n      character.state === STATES.WALK &&\n      !character.speed.x && !character.speed.y &&\n      character.nextTile.data.collision === false &&\n      (character.nextTile.data.character?.properties.visible !== true || character.nextTile.data.character?.collision !== true)\n    ) {\n      character.speed.x = speedX\n      character.speed.y = speedY\n      updatePosition(character.speed.x ? \"x\" : \"y\", true)\n    } else if (character.speed.x || character.speed.y) {\n      updatePosition(character.speed.x ? \"x\" : \"y\")\n    } else {\n      updateState()\n    }\n\n    updateTextures()\n    character.postUpdate()\n  }\n\n  function postUpdate() {\n    character.sprite.x = position.x\n    character.sprite.y = position.y\n  }\n\n  function updateNextTile(speedX, speedY) {\n    const nextX = Math.floor(position.x / SIZE + speedX)\n    const nextY = Math.floor(position.y / SIZE + speedY)\n\n    if (character.nextTile.x === nextX && character.nextTile.y === nextY) return\n\n    const data = character.game.world.tileAt(nextX, nextY)\n\n    character.nextTile = {\n      x: nextX,\n      y: nextY,\n      data,\n    }\n  }\n\n  function updatePosition(dimension, move) {\n    if (!character.speed[dimension]) return\n\n    const speed = character.speed[dimension] * SPEED\n    const remainder = position[dimension] % SIZE\n\n    if (remainder || move) {\n      position[dimension] += speed\n    } else {\n      character.speed[dimension] = 0\n      character.updateState()\n    }\n  }\n\n  function updateState() {\n    if (character.nextDirection) {\n      character.direction = character.nextDirection\n      character.nextDirection = null\n    }\n\n    if (character.nextState) {\n      character.state = character.nextState\n      character.nextState = null\n    }\n\n    game.world.tileAt(position.x / SIZE, position.y / SIZE, { character })\n  }\n\n  function updateTextures() {\n    if (!character.sprite) return\n    const textures = character.textures[character.state + upperCase(character.direction)]\n    if (!textures || character.sprite.textures === textures) return\n    character.sprite.textures = textures\n    character.sprite.play()\n  }\n\n  function addSpritesheet() {\n    const spritesheet = new Spritesheet(resources.characters.texture, getData(id))\n    character.spritesheet = spritesheet\n\n    spritesheet.parse(() => {\n      loadSprite()\n    })\n  }\n\n  function loadSprite() {\n    character.textures.stillDown = [character.spritesheet.textures[\"stillDown\" + id]]\n    character.textures.stillUp = [character.spritesheet.textures[\"stillUp\" + id]]\n    character.textures.stillLeft = [character.spritesheet.textures[\"stillLeft\" + id]]\n    character.textures.stillRight = [character.spritesheet.textures[\"stillRight\" + id]]\n\n    character.textures.walkDown = getTextures(character.spritesheet, \"walkDown\")\n    character.textures.walkUp = getTextures(character.spritesheet, \"walkUp\")\n    character.textures.walkLeft = getTextures(character.spritesheet, \"walkLeft\")\n    character.textures.walkRight = getTextures(character.spritesheet, \"walkRight\")\n\n    const sprite = new AnimatedSprite(character.textures[character.state + upperCase(character.direction)])\n    character.sprite = sprite\n\n    sprite.width = SIZE\n    sprite.height = SIZE\n    sprite.animationSpeed = 0.1\n    sprite.x = x\n    sprite.y = y\n\n    container.addChild(sprite)\n  }\n\n  let event = null\n  let nextTile = { data: {} }\n  const properties = await database.getItem(\"properties\") || {}\n  const position = await createPosition(character, database, x, y)\n\n  if (!characters[id]) addSpritesheet()\n  else loadSprite()\n\n  character.game.app.ticker.add(update)\n\n  characters[id] = character\n\n  return character\n}\n\nasync function loadResources() {\n  return new Promise(resolve => {\n    new Loader().add(\"characters\", texture).load((loader, loadedResources) => {\n      resources = loadedResources\n      resolve()\n    })\n  })\n}\n\nasync function createPosition(character, database, startX, startY) {\n  function removeCharacter() {\n    character.game.world.tileAt(position.x / SIZE, position.y / SIZE, { character: null })\n  }\n\n  const positionDB = await database.getItem(\"position\")\n  let x = positionDB?.x ?? startX\n  let y = positionDB?.y ?? startY\n\n  const position = {\n    get x() {\n      return x\n    },\n    set x(newX) {\n      if (x % SIZE === 0) removeCharacter()\n\n      x = newX\n      if (x % SIZE === 0) {\n        database.setItem(\"position\", { ...position, x })\n      }\n    },\n    get y() {\n      return y\n    },\n    set y(newY) {\n      if (y % SIZE === 0) removeCharacter()\n\n      y = newY\n      if (y % SIZE === 0) {\n        database.setItem(\"position\", { ...position, y })\n      }\n    }\n  }\n\n  return position\n}\n\nfunction getTextures(spriteSheet, key) {\n  return spriteSheet.data.animations[key].map(id => {\n    const texture = spriteSheet.textures[id]\n    texture.rotate = spriteSheet.data.frames[id].rotate ?? texture.rotate\n    return texture\n  })\n}\n\nfunction getData(id) {\n  return {\n    meta: {},\n    frames: {\n      [\"stillDown\" + id]: {\n        frame: getFrame(id),\n      },\n      [\"stillUp\" + id]: {\n        frame: getFrame(id + 1),\n      },\n      [\"stillLeft\" + id]: {\n        frame: getFrame(id + 2),\n      },\n      [\"stillRight\" + id]: {\n        frame: getFrame(id + 2),\n        [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n      },\n\n      [\"walkDown0\" + id]: {\n        frame: getFrame(id + 3)\n      },\n      [\"walkDown1\" + id]: {\n        frame: getFrame(id + 3),\n        [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n      },\n\n      [\"walkUp0\" + id]: {\n        frame: getFrame(id + 4),\n      },\n      [\"walkUp1\" + id]: {\n        frame: getFrame(id + 4),\n        [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n      },\n\n      [\"walkLeft\" + id]: {\n        frame: getFrame(id + 5),\n      },\n\n      [\"walkRight\" + id]: {\n        frame: getFrame(id + 5),\n        [ROTATE]: groupD8.MIRROR_HORIZONTAL,\n      },\n    },\n\n    animations: {\n      walkDown: [\"walkDown0\" + id, \"stillDown\" + id, \"walkDown1\" + id, \"stillDown\" + id],\n      walkUp: [\"walkUp0\" + id, \"stillUp\" + id, \"walkUp1\" + id, \"stillUp\" + id],\n      walkLeft: [\"walkLeft\" + id, \"stillLeft\" + id],\n      walkRight: [\"walkRight\" + id, \"stillRight\" + id],\n    },\n  }\n}\n\nfunction getFrame(id) {\n  return {\n    x: (id % COLUMNS) * TILE_SIZE,\n    y: (Math.floor(id / COLUMNS)) * TILE_SIZE,\n    w: TILE_SIZE,\n    h: TILE_SIZE,\n  }\n}\n\nfunction createEvent(callback) {\n  let resolve = null\n\n  const event = {\n    check,\n    promise: new Promise(callback => {\n      resolve = callback\n    }),\n  }\n\n  function check() {\n    if (callback()) {\n      resolve()\n      return true\n    }\n  }\n\n  return event\n}\n\nlet resources = null\nlet loadingResources = null\nconst characters = {}","import { SIZE, CHARACTERS } from \"libraries/constants\"\nimport { createCharacter, STATES } from \"./Character\"\n\nexport async function createPlayer(game) {\n  const player = await createCharacter(\n    game,\n    CHARACTERS.PLAYER,\n    game.app.stage,\n    game.app.screen.width / 2 - SIZE / 2,\n    game.app.screen.height / 2 - SIZE / 2,\n  )\n\n  function still(direction) {\n    characterStill(direction)\n    clearTimeout(faceTimeout)\n  }\n\n  function face(direction) {\n    characterFace(direction)\n    faceTimeout = setTimeout(() => walk(direction), 50)\n  }\n\n  function walk(direction) {\n    if (player.direction !== direction && player.state !== STATES.WALK) face(direction)\n    else characterWalk(direction)\n  }\n\n  function updateState(prevTile) {\n    characterUpdateState(prevTile)\n\n    const { data } = player.nextTile\n    if (data.location || data.layer) {\n      const [x, y] = data.position.split(\",\")\n      game.world.setLocation(data.location, data.layer, { x: x * SIZE, y: y * SIZE })\n    }\n  }\n\n  function loadEvent({ data }) {\n    if (data.event) {\n      game.world.events[data.event]()\n    }\n  }\n\n  const {\n    walk: characterWalk,\n    face: characterFace,\n    still: characterStill,\n    updateState: characterUpdateState,\n  } = player\n\n  player.still = still\n  player.face = face\n  player.walk = walk\n  player.updateState = updateState\n  player.postUpdate = () => { }\n  player.onNextTileUpdate = loadEvent\n\n  let faceTimeout = null\n\n  return player\n}","import { Graphics, Loader, Container, UPDATE_PRIORITY } from \"pixi.js\"\nimport worldTexture from \"images/world.png\"\nimport worldData from \"images/data/world.json\"\nimport { SIZE } from \"libraries/constants\"\nimport { playerDB } from \"libraries/database\"\nimport { createCharacter } from \"./Character\"\n\nexport async function createWorld(game) {\n  const world = {\n    game,\n    update,\n    tileAt,\n    setLocation,\n    load,\n    events: null,\n    get location() {\n      return location\n    },\n    set location(newLocation) {\n      location = newLocation\n      playerDB.setItem(\"location\", newLocation)\n    },\n    get layer() {\n      return layer\n    },\n    set layer(newLayer) {\n      layer = newLayer\n      playerDB.setItem(\"layer\", newLayer)\n    },\n    texture: null,\n    data: null,\n    map: {},\n    tiles: {},\n    characters: {},\n    camera: new Container(),\n  }\n\n  function update() {\n    const position = world.game.player.position\n    world.camera.pivot.x = -world.game.player.sprite?.x\n    world.camera.pivot.y = -world.game.player.sprite?.y\n    world.camera.position.x = -position.x\n    world.camera.position.y = -position.y\n  }\n\n  function setLocation(location, layer, position) {\n    world.location = location || world.location\n    world.layer = layer || \"index\"\n    playerDB.setItem(\"location\", world.location)\n    playerDB.setItem(\"layer\", world.layer)\n    loadMapLocation(position)\n  }\n\n  async function load() {\n    const texture = await loadTexture()\n    world.texture = texture\n    world.data = {\n      tileSize: worldData.tilewidth,\n      columns: worldData.columns,\n      tiles: worldData.tiles.reduce((acc, tile) => {\n        acc[tile.id] = tile.properties.reduce(addProperties, {})\n        return acc\n      }, {})\n    }\n    await loadMapLocation()\n    world.game.enableControls = true\n  }\n\n  async function loadMapLocation(position) {\n    const eventsImport = import(`scripts/${world.location}/${world.layer}`).catch(() => ({}))\n\n    const { location, layer } = world\n    let locationMap = world.map[location + layer]\n    let locationCharacters = world.characters[location + layer]\n\n    if (!locationMap) {\n      const locationTiles = {}\n      locationMap = new Container()\n      locationCharacters = {}\n\n      const { layers, tilesets, width } = await import(`maps/${location}.json`)\n      const promises = []\n\n      layers.forEach(item => {\n        if (item.name !== layer) return\n\n        if (item.type === \"tilelayer\") loadTile({ item, tilesets, locationTiles, locationMap, width })\n\n        if (item.type === \"objectgroup\") loadObject({ item, tilesets, locationTiles, locationCharacters, locationMap, promises })\n      })\n\n      await Promise.all(promises)\n\n      world.map[location + layer] = locationMap\n      world.tiles[location + layer] = locationTiles\n      world.characters[location + layer] = locationCharacters\n    }\n\n    const { getEvents } = await eventsImport\n\n    world.events = getEvents ? getEvents(game) : null\n    world.camera.removeChildren()\n    world.camera.addChild(locationMap)\n    world.game.characters = locationCharacters\n    if (position) world.game.player.position = position\n  }\n\n  function tileAt(x, y, data) {\n    const key = `${x}-${y}`\n    const tiles = world.tiles[location + layer]\n    if (!tiles) return {}\n    if (data) {\n      if (!tiles[key]) tiles[key] = data\n      else tiles[key] = { ...tiles[key], ...data }\n    }\n    return tiles[key] || {}\n  }\n\n\n  function loadTile({ item, tilesets, locationTiles, locationMap, width }) {\n    const { tileSize, columns } = world.data\n\n    item.data.forEach((value, index) => {\n      if (!value) return\n      const id = parseInt(value, 10) - tilesets[0].firstgid\n      const object = world.data.tiles[id] || {}\n      const x = (index % width)\n      const y = Math.floor(index / width)\n      const tileX = (id % columns) * tileSize\n      const tileY = Math.floor(id / columns) * tileSize\n\n      locationTiles[`${x}-${y}`] = object\n\n      addGraphic({\n        texture: world.texture,\n        map: locationMap,\n        tileX,\n        tileY,\n        x,\n        y,\n        tileSize,\n      })\n    })\n  }\n\n  function loadObject({ item, tilesets, locationTiles, locationCharacters, locationMap, promises }) {\n    const { tileSize, columns } = world.data\n\n    item.objects.forEach(async object => {\n      const { gid } = object\n      if (!tilesets[1] || gid < tilesets[1].firstgid) {\n        const id = gid - tilesets[0].firstgid\n        const tileX = (id % columns) * tileSize\n        const tileY = Math.floor(id / columns) * tileSize\n        const x = object.x / tileSize\n        const y = object.y / tileSize - 1\n\n        locationTiles[`${x}-${y}`] = { ...(world.data.tiles[id] || {}), ...object.properties.reduce(addProperties, {}) }\n\n        addGraphic({\n          texture: world.texture,\n          map: locationMap,\n          tileX,\n          tileY,\n          x,\n          y,\n          tileSize,\n        })\n      } else {\n        const id = gid - tilesets[1].firstgid\n        const promise = createCharacter(world.game, id, locationMap, SIZE * object.x / tileSize, SIZE * (object.y / tileSize - 1))\n        promises.push(promise)\n\n        const properties = object.properties ? object.properties.reduce(addProperties, {}) : {}\n\n        const character = await promise\n        character.properties = { ...properties, ...character.properties }\n\n        locationCharacters[id] = character\n      }\n    })\n  }\n\n  game.app.stage.addChildAt(world.camera, 0)\n\n  game.app.ticker.add(update, null, UPDATE_PRIORITY.INTERACTION)\n\n  let location = null\n  let layer = null\n\n  return world\n}\n\nfunction loadTexture() {\n  return new Promise(resolve => {\n    new Loader().add(\"world\", worldTexture).load((loader, resources) => {\n      resolve(resources.world.texture)\n    })\n  })\n}\n\nfunction addGraphic({ texture, map, tileX, tileY, x, y, tileSize }) {\n  const graphics = new Graphics()\n\n  graphics.beginTextureFill({ texture })\n  graphics.drawRect(tileX, tileY, tileSize, tileSize)\n\n  graphics.width = SIZE\n  graphics.height = SIZE\n\n  graphics.x = -tileX * graphics.scale.x + x * SIZE\n  graphics.y = -tileY * graphics.scale.y + y * SIZE\n\n  map.addChild(graphics)\n}\n\nfunction addProperties(acc, property) {\n  acc[property.name] = property.value\n  return acc\n}","import { Application, utils, settings, SCALE_MODES } from \"pixi.js\"\nimport { CONTROLS, SIZE } from \"libraries/constants\"\nimport { playerDB } from \"libraries/database\"\nimport { loadText } from \"libraries/util\"\nimport { createPlayer } from \"./Player\"\nimport { createWorld } from \"./World\"\n\nexport async function createGame({ view, setMessage }) {\n  const game = {\n    setMessage,\n    app: null,\n    action: null,\n    player: null,\n    world: null,\n    characters: {},\n    enableControls: false,\n  }\n\n  function handleAction({ detail }) {\n    if (!game.enableControls) {\n      game.action = null\n      return\n    } else {\n      game.action = detail\n    }\n\n    switch (game.action) {\n      case CONTROLS.UP:\n      case CONTROLS.LEFT:\n      case CONTROLS.RIGHT:\n      case CONTROLS.DOWN: {\n        game.player.walk(game.action)\n        break\n      }\n\n      default: {\n        game.player.still()\n      }\n    }\n  }\n\n  const save = {\n    position: await playerDB.getItem(\"position\"),\n    location: await playerDB.getItem(\"location\"),\n    layer: await playerDB.getItem(\"layer\"),\n  }\n\n  await prepareGame(game, view)\n\n  if (!save.position) {\n    loadText(\"welcome\", setMessage)\n    game.player.position = { x: SIZE * 3, y: SIZE * 6 }\n    game.world.location = \"PalletTownRooms\"\n    game.world.layer = \"house1 f2\"\n  } else {\n    game.world.location = save.location\n    game.world.layer = save.layer\n  }\n\n  game.world.load()\n\n  window.addEventListener(\"action\", handleAction)\n}\n\nasync function prepareGame(game, view) {\n  utils.skipHello()\n  settings.SCALE_MODE = SCALE_MODES.NEAREST\n\n  game.app = new Application({\n    view,\n    width: 1920,\n    height: 1080,\n  })\n\n  game.app.renderer.plugins.accessibility.destroy()\n  delete game.app.renderer.plugins.accesibility\n\n  game.player = await createPlayer(game)\n  game.world = await createWorld(game)\n}"],"sourceRoot":""}